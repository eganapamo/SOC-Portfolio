# Lab 11 — Suspicious Command Chain Detection

## Objective
The objective of this lab was to detect suspicious command execution behavior within Linux authentication logs by identifying administrative and high-risk commands that may indicate privilege escalation, persistence creation, or post-compromise attacker activity.

## Environment
- Operating System: Kali Linux 
- Log Source: /var/log/auth.log 
- Tools Used: grep, awk 

## Step 1 — Search for High-Risk Administrative Commands
To begin, I searched the authentication logs for commands commonly associated with administrative control or attacker behavior.

Command Used:
sudo grep -aiE "chmod|wget|curl|bash|sh|useradd|adduser|usermod" /var/log/auth.log

This command scans the authentication logs for privilege use, execution behavior, and account modification activity.

## Step 2 — Remove Investigation Noise
While searching logs, grep activity itself appears in auth.log. To isolate meaningful system activity, I removed entries generated by my own investigation commands.

Command Used:
sudo grep -aiE "chmod|wget|curl|bash|sh|useradd|adduser|usermod" /var/log/auth.log | grep -iv "COMMAND=/usr/bin/grep"

This ensures only legitimate system activity is displayed rather than commands executed during analysis.

## Step 3 — Extract Only Executed Commands
To simplify output and clearly view the executed administrative commands, I extracted only the portion of the log that appears after COMMAND=.

Command Used:
sudo grep -ai "COMMAND=" /var/log/auth.log | grep -aiE "chmod|wget|curl|bash|sh|useradd|adduser|usermod" | grep -iv "COMMAND=/usr/bin/grep" | awk -F "COMMAND=" '{print $2}'

This isolates the actual command executed by the system.

## Step 4 — Identify Account Creation Activity
From the refined output, the key event observed was:

/usr/sbin/adduser labuser

This indicates that a new user account named labuser was created using the system’s administrative adduser utility.

## Step 5 — Understand Command Path Significance
The log recorded the full executable path of the command:

/usr/sbin/adduser

The directory /usr/sbin contains system-level administrative tools. Seeing the command executed from this trusted directory indicates that the legitimate system binary was used.

In contrast, attacker behavior often involves executing tools from abnormal directories such as:
/tmp/
/home/user/
/dev/shm/
/usr/local/bin (custom drop locations)

The execution path is therefore an important forensic indicator.

## Investigative Context
If this were a real SOC investigation, I would additionally verify:
- The identity of the user executing the command
- The time of execution
- Whether the new account was expected
- Any follow-on activity such as group modifications, password changes, SSH key updates, downloads, or additional privilege escalation

## Conclusion
In this lab, I successfully detected administrative command execution within Linux authentication logs by filtering for high-risk commands and removing investigation noise. The key activity identified was the creation of a new user account using the legitimate administrative binary located at /usr/sbin/adduser.

This lab reinforced the importance of:
- Detecting suspicious command chains
- Removing investigative noise from logs
- Understanding the significance of command execution paths
- Differentiating legitimate administrative behavior from potential attacker activity

By refining log searches and isolating meaningful signals, I strengthened my ability to analyze Linux authentication logs for signs of privilege escalation and persistence.
